{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "# To-Do List:\n",
    "\n",
    "# Access RDS YES\n",
    "\n",
    "# Send all the data to s3 in proper folders NOT WORTH IT\n",
    "\n",
    "# Create recordio files from folders in s3 YES\n",
    "\n",
    "# Run it NOT YET"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "#DOWNLOAD IM2REC.PY\n",
    "\n",
    "import os\n",
    "import urllib.request\n",
    "\n",
    "def download(url):\n",
    "    filename = url.split(\"/\")[-1]\n",
    "    if not os.path.exists(filename):\n",
    "        urllib.request.urlretrieve(url, filename)\n",
    "        \n",
    "download('https://raw.githubusercontent.com/apache/incubator-mxnet/master/tools/im2rec.py')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:sagemaker:Couldn't call 'get_role' to get Role ARN from role name SageMakerAll to get Role path.\n"
     ]
    }
   ],
   "source": [
    "# SETUP\n",
    "\n",
    "bucket = 'nicu-data'\n",
    "\n",
    "import boto3\n",
    "import re\n",
    "from sagemaker.amazon.amazon_estimator import get_image_uri\n",
    "from sagemaker import get_execution_role\n",
    "role = get_execution_role()\n",
    "\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import sagemaker\n",
    "from sagemaker.predictor import csv_serializer \n",
    "from sklearn import metrics\n",
    "from sklearn.metrics import roc_auc_score\n",
    "import matplotlib.pyplot as plt  \n",
    "from sqlalchemy import create_engine\n",
    "\n",
    "s3 = boto3.client('s3')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: pymysql in /home/ec2-user/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages (0.9.3)\n",
      "\u001b[33mYou are using pip version 10.0.1, however version 19.0.3 is available.\n",
      "You should consider upgrading via the 'pip install --upgrade pip' command.\u001b[0m\n"
     ]
    }
   ],
   "source": [
    "# Download pymysql\n",
    "import sys\n",
    "!{sys.executable} -m pip install pymysql"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "# Connect to the database\n",
    "db_engine = create_engine('mysql+pymysql://isaiah:nicu_isaiah@nicu-2019-03-05.c2lckhwrw1as.us-east-1.rds.amazonaws.com:3306/nicu')\n",
    "connection = db_engine.connect()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Create Folders in S3\n",
    "\n",
    "#boto3.Session().resource('s3').Bucket(bucket).Object('databasefiles/recording_id{}/jimmy.txt'.format(1)).upload_file('jimmy.txt')\n",
    "#boto3.Session().resource('s3').Bucket(bucket).Object('databasefiles/recording_id_{}/howdy.txt'.format(1)).upload_file('howdy.txt')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "160\n"
     ]
    }
   ],
   "source": [
    "#Work with 10 Rows\n",
    "\n",
    "# query data from database\n",
    "query1 = (\" SELECT Raw.isCSGM, Raw.recording_id, Raw.timestamp, Raw.RGB_frame \"\n",
    "         \" FROM Video_Raw Raw \"\n",
    "         \" WHERE Raw.recording_id = 2 \"\n",
    "         \" ORDER BY Raw.timestamp \"\n",
    "         \" LIMIT 40 \")\n",
    "\n",
    "query2 = (\" SELECT Raw.isCSGM, Raw.recording_id, Raw.timestamp, Raw.RGB_frame \"\n",
    "         \" FROM Video_Raw Raw \"\n",
    "         \" WHERE Raw.recording_id = 3 \"\n",
    "         \" ORDER BY Raw.timestamp \"\n",
    "         \" LIMIT 40 \")\n",
    "\n",
    "query3 = (\" SELECT Raw.isCSGM, Raw.recording_id, Raw.timestamp, Raw.RGB_frame \"\n",
    "         \" FROM Video_Raw Raw \"\n",
    "         \" WHERE Raw.recording_id = 4 \"\n",
    "         \" ORDER BY Raw.timestamp \"\n",
    "         \" LIMIT 40 \")\n",
    "\n",
    "query4 = (\" SELECT Raw.isCSGM, Raw.recording_id, Raw.timestamp, Raw.RGB_frame \"\n",
    "         \" FROM Video_Raw Raw \"\n",
    "         \" WHERE Raw.recording_id = 4 \"\n",
    "         \" ORDER BY Raw.timestamp \"\n",
    "         \" LIMIT 40 \")\n",
    "\n",
    "# data_df is a dataframe\n",
    "data_df = pd.read_sql(query1, connection).values\n",
    "data_df = np.append(data_df,pd.read_sql(query2,connection).values)\n",
    "data_df = np.append(data_df,pd.read_sql(query3,connection).values)\n",
    "data_df = np.append(data_df,pd.read_sql(query4,connection).values)\n",
    "\n",
    "\n",
    "#print (data_df)   \n",
    "    \n",
    "# Get the count in the database\n",
    "#query_for_count = (\" SELECT COUNT(Raw.id) count \"\n",
    "#                   \" FROM Video_Raw Raw \"\n",
    "#                   \" WHERE Raw.id > 11 AND Raw.id < 22 \")\n",
    "#count = pd.read_sql(query_for_count, connection).values.item(0)\n",
    "count = int(data_df.size/4)\n",
    "print(count)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "# USEFUL REMOVE COMMAND AND FUNCTION\n",
    "\n",
    "# REMOVE ALL FILES\n",
    "\n",
    "import shutil\n",
    "shutil.rmtree(\"PNGfiles\")\n",
    "\n",
    "\n",
    "# REMOVE ALL LST FILES\n",
    "\n",
    "#import os\n",
    "#def scandirs(path):\n",
    "#    for root, dirs, files in os.walk(path):\n",
    "#        for currentFile in files:\n",
    "#            exts = ('.lst', '.rec', '.idx')\n",
    "#            if currentFile.lower().endswith(exts):\n",
    "#                os.remove(os.path.join(root, currentFile))\n",
    "#scandirs(\"PNGfiles\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import os.path\n",
    "\n",
    "# CREATE AND POPULATE FOLDERS WITH DB DATA\n",
    "path = \"PNGfiles\"\n",
    "os.mkdir(path)\n",
    "for k in range(2,14):\n",
    "    os.mkdir(\"{}/recording_id_{}\".format(path, k))\n",
    "    os.mkdir(\"{}/recording_id_{}/isCSGM\".format(path, k))\n",
    "    os.mkdir(\"{}/recording_id_{}/noCSGM\".format(path, k))\n",
    "       \n",
    "for i in range(0, (count)*4, 4):\n",
    "    csgm = data_df.item(i)\n",
    "    rec_id = data_df.item(i+1)\n",
    "    time = str(data_df.item(i+2))\n",
    "    png = data_df.item(i+3)\n",
    "    # if non-csgm, then send png file to all folders except for the single folder that excludes that baby\n",
    "    if csgm == 0:\n",
    "        for j in range(2,14):\n",
    "            if rec_id != j:\n",
    "                folder = \"{}/recording_id_{}/noCSGM\".format(path, j) #create folder pathname for the png file\n",
    "                filename = os.path.join(folder, \"{}_%s.png\".format(rec_id) % (time))\n",
    "                fh = open(filename, \"wb\")\n",
    "                fh.write(png)\n",
    "                fh.close()\n",
    "    if csgm == 1:\n",
    "        for j in range(2,14):\n",
    "            if rec_id != j:\n",
    "                folder = \"{}/recording_id_{}/isCSGM\".format(path, j) #create folder pathname for the png file\n",
    "                filename = os.path.join(folder, \"{}_%s.png\".format(rec_id) % (time))\n",
    "                fh = open(filename, \"wb\")\n",
    "                fh.write(png)\n",
    "                fh.close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_2/2_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_2\n",
      "time: 0.020406246185302734  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_2/2_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_2\n",
      "time: 0.022074460983276367  count: 0\n",
      "Completed 256.0 KiB/2.2 MiB (3.7 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/2.2 MiB (6.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/2.2 MiB (9.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/2.2 MiB (12.3 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.2 MiB/2.2 MiB (14.6 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.5 MiB/2.2 MiB (16.7 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.8 MiB/2.2 MiB (18.8 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.0 MiB/2.2 MiB (21.0 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.2 MiB/2.2 MiB (17.3 MiB/s) with 1 file(s) remaining \r",
      "upload: PNGfiles/recording_id_2/2_train.rec to s3://nicu-data/recfiles/train/recording_id_2/2_train.rec\n",
      "Completed 256.0 KiB/949.1 KiB (5.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/949.1 KiB (9.5 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/949.1 KiB (13.1 MiB/s) with 1 file(s) remaining\r",
      "Completed 949.1 KiB/949.1 KiB (7.5 MiB/s) with 1 file(s) remaining \r",
      "upload: PNGfiles/recording_id_2/2_val.rec to s3://nicu-data/recfiles/validation/recording_id_2/2_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_3/3_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_3\n",
      "time: 0.015760183334350586  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_3/3_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_3\n",
      "time: 0.020651817321777344  count: 0\n",
      "Completed 256.0 KiB/1.9 MiB (1.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.9 MiB (3.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.9 MiB (5.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.9 MiB (7.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.9 MiB (9.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/1.9 MiB (10.6 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.8 MiB/1.9 MiB (12.3 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.9 MiB/1.9 MiB (6.2 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_3/3_train.rec to s3://nicu-data/recfiles/train/recording_id_3/3_train.rec\n",
      "Completed 256.0 KiB/828.5 KiB (7.0 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/828.5 KiB (13.1 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/828.5 KiB (18.5 MiB/s) with 1 file(s) remaining\r",
      "Completed 828.5 KiB/828.5 KiB (7.6 MiB/s) with 1 file(s) remaining \r",
      "upload: PNGfiles/recording_id_3/3_val.rec to s3://nicu-data/recfiles/validation/recording_id_3/3_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_4/4_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_4\n",
      "time: 0.023430824279785156  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_4/4_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_4\n",
      "time: 0.02777886390686035  count: 0\n",
      "Completed 256.0 KiB/2.8 MiB (5.1 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/2.8 MiB (8.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/2.8 MiB (12.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/2.8 MiB (15.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/2.8 MiB (18.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/2.8 MiB (21.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/2.8 MiB (23.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/2.8 MiB (26.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/2.8 MiB (29.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/2.8 MiB (31.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/2.8 MiB (33.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/2.8 MiB (18.5 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_4/4_train.rec to s3://nicu-data/recfiles/train/recording_id_4/4_train.rec\n",
      "Completed 256.0 KiB/1.2 MiB (5.5 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.2 MiB (9.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.2 MiB (13.1 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.2 MiB (16.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.2 MiB (13.3 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_4/4_val.rec to s3://nicu-data/recfiles/validation/recording_id_4/4_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_5/5_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_5\n",
      "time: 0.033373117446899414  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_5/5_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_5\n",
      "time: 0.019710779190063477  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (3.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (6.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (9.7 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (12.5 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.2 MiB/3.5 MiB (15.3 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.5 MiB/3.5 MiB (17.9 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.8 MiB/3.5 MiB (20.4 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.0 MiB/3.5 MiB (22.8 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.2 MiB/3.5 MiB (25.2 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.5 MiB/3.5 MiB (27.4 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.8 MiB/3.5 MiB (29.6 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.0 MiB/3.5 MiB (31.8 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.2 MiB/3.5 MiB (33.9 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.5 MiB/3.5 MiB (36.0 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.5 MiB/3.5 MiB (20.5 MiB/s) with 1 file(s) remaining \r",
      "upload: PNGfiles/recording_id_5/5_train.rec to s3://nicu-data/recfiles/train/recording_id_5/5_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (5.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (10.7 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (14.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (19.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (22.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (16.4 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_5/5_val.rec to s3://nicu-data/recfiles/validation/recording_id_5/5_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_6/6_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_6\n",
      "time: 0.019479751586914062  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_6/6_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_6\n",
      "time: 0.026113510131835938  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (4.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (8.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (12.1 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (15.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/3.5 MiB (18.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/3.5 MiB (20.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/3.5 MiB (23.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/3.5 MiB (26.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/3.5 MiB (28.4 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/3.5 MiB (30.7 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/3.5 MiB (32.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.0 MiB/3.5 MiB (35.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.2 MiB/3.5 MiB (37.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (39.4 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (23.8 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_6/6_train.rec to s3://nicu-data/recfiles/train/recording_id_6/6_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (5.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (9.2 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (12.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (15.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (18.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (7.1 MiB/s) with 1 file(s) remaining   \r",
      "upload: PNGfiles/recording_id_6/6_val.rec to s3://nicu-data/recfiles/validation/recording_id_6/6_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_7/7_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_7\n",
      "time: 0.023541927337646484  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_7/7_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_7\n",
      "time: 0.027796268463134766  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (4.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (8.3 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (11.3 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (14.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/3.5 MiB (16.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/3.5 MiB (19.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/3.5 MiB (21.6 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/3.5 MiB (24.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/3.5 MiB (26.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/3.5 MiB (28.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/3.5 MiB (30.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.0 MiB/3.5 MiB (32.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.2 MiB/3.5 MiB (34.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (35.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (20.0 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_7/7_train.rec to s3://nicu-data/recfiles/train/recording_id_7/7_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (5.1 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (8.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (11.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (14.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (17.7 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (8.9 MiB/s) with 1 file(s) remaining   \r",
      "upload: PNGfiles/recording_id_7/7_val.rec to s3://nicu-data/recfiles/validation/recording_id_7/7_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_8/8_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_8\n",
      "time: 0.02247333526611328  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_8/8_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_8\n",
      "time: 0.022539377212524414  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (5.0 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (9.2 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (12.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (16.4 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/3.5 MiB (19.7 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/3.5 MiB (22.6 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/3.5 MiB (25.6 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/3.5 MiB (28.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/3.5 MiB (31.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/3.5 MiB (33.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/3.5 MiB (35.7 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.0 MiB/3.5 MiB (38.4 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.2 MiB/3.5 MiB (40.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (42.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (23.3 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_8/8_train.rec to s3://nicu-data/recfiles/train/recording_id_8/8_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (5.0 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (8.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (11.5 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (14.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (16.6 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (10.2 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_8/8_val.rec to s3://nicu-data/recfiles/validation/recording_id_8/8_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_9/9_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_9\n",
      "time: 0.024420738220214844  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_9/9_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_9\n",
      "time: 0.023553848266601562  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (4.2 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (7.5 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (10.3 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (13.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/3.5 MiB (15.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/3.5 MiB (17.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/3.5 MiB (19.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/3.5 MiB (21.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/3.5 MiB (23.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/3.5 MiB (25.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/3.5 MiB (27.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.0 MiB/3.5 MiB (29.4 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.2 MiB/3.5 MiB (31.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (32.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (17.8 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_9/9_train.rec to s3://nicu-data/recfiles/train/recording_id_9/9_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (4.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (8.5 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (11.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (14.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (17.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (8.8 MiB/s) with 1 file(s) remaining   \r",
      "upload: PNGfiles/recording_id_9/9_val.rec to s3://nicu-data/recfiles/validation/recording_id_9/9_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_10/10_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_10\n",
      "time: 0.02205038070678711  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_10/10_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_10\n",
      "time: 0.032961130142211914  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (4.7 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (8.0 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (11.2 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (14.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/3.5 MiB (16.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/3.5 MiB (19.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/3.5 MiB (21.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/3.5 MiB (23.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/3.5 MiB (25.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/3.5 MiB (27.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/3.5 MiB (29.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.0 MiB/3.5 MiB (30.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.2 MiB/3.5 MiB (32.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (34.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (16.7 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_10/10_train.rec to s3://nicu-data/recfiles/train/recording_id_10/10_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (1.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (3.0 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (4.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (5.7 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (7.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (4.2 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_10/10_val.rec to s3://nicu-data/recfiles/validation/recording_id_10/10_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_11/11_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_11\n",
      "time: 0.021714210510253906  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_11/11_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_11\n",
      "time: 0.021483898162841797  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (3.3 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (6.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (9.3 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (12.2 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.2 MiB/3.5 MiB (14.8 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.5 MiB/3.5 MiB (17.4 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.8 MiB/3.5 MiB (19.9 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.0 MiB/3.5 MiB (22.2 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.2 MiB/3.5 MiB (24.6 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.5 MiB/3.5 MiB (26.8 MiB/s) with 1 file(s) remaining \r",
      "Completed 2.8 MiB/3.5 MiB (29.1 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.0 MiB/3.5 MiB (31.2 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.2 MiB/3.5 MiB (33.4 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.5 MiB/3.5 MiB (35.5 MiB/s) with 1 file(s) remaining \r",
      "Completed 3.5 MiB/3.5 MiB (19.3 MiB/s) with 1 file(s) remaining \r",
      "upload: PNGfiles/recording_id_11/11_train.rec to s3://nicu-data/recfiles/train/recording_id_11/11_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (3.7 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (6.6 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (9.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (12.1 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.2 MiB/1.4 MiB (14.5 MiB/s) with 1 file(s) remaining \r",
      "Completed 1.4 MiB/1.4 MiB (5.2 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_11/11_val.rec to s3://nicu-data/recfiles/validation/recording_id_11/11_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_12/12_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_12\n",
      "time: 0.029720783233642578  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_12/12_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_12\n",
      "time: 0.022577285766601562  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (4.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (8.7 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (12.0 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (15.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/3.5 MiB (17.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/3.5 MiB (20.6 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/3.5 MiB (23.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/3.5 MiB (25.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/3.5 MiB (27.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/3.5 MiB (30.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/3.5 MiB (32.3 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.0 MiB/3.5 MiB (34.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.2 MiB/3.5 MiB (36.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (38.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (24.3 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_12/12_train.rec to s3://nicu-data/recfiles/train/recording_id_12/12_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (6.2 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (10.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (14.8 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (18.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (21.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (13.2 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_12/12_val.rec to s3://nicu-data/recfiles/validation/recording_id_12/12_val.rec\n",
      "noCSGM 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_13/13_val.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_13\n",
      "time: 0.032387495040893555  count: 0\n",
      "Creating .rec file from /home/ec2-user/SageMaker/PNGfiles/recording_id_13/13_train.lst in /home/ec2-user/SageMaker/PNGfiles/recording_id_13\n",
      "time: 0.02205061912536621  count: 0\n",
      "Completed 256.0 KiB/3.5 MiB (5.4 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/3.5 MiB (10.1 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/3.5 MiB (14.5 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/3.5 MiB (18.6 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/3.5 MiB (22.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.5 MiB/3.5 MiB (26.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.8 MiB/3.5 MiB (29.8 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.0 MiB/3.5 MiB (33.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.2 MiB/3.5 MiB (36.7 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.5 MiB/3.5 MiB (39.1 MiB/s) with 1 file(s) remaining  \r",
      "Completed 2.8 MiB/3.5 MiB (41.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.0 MiB/3.5 MiB (43.2 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.2 MiB/3.5 MiB (45.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (48.5 MiB/s) with 1 file(s) remaining  \r",
      "Completed 3.5 MiB/3.5 MiB (26.8 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_13/13_train.rec to s3://nicu-data/recfiles/train/recording_id_13/13_train.rec\n",
      "Completed 256.0 KiB/1.4 MiB (5.0 MiB/s) with 1 file(s) remaining\r",
      "Completed 512.0 KiB/1.4 MiB (8.7 MiB/s) with 1 file(s) remaining\r",
      "Completed 768.0 KiB/1.4 MiB (11.9 MiB/s) with 1 file(s) remaining\r",
      "Completed 1.0 MiB/1.4 MiB (15.0 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.2 MiB/1.4 MiB (17.9 MiB/s) with 1 file(s) remaining  \r",
      "Completed 1.4 MiB/1.4 MiB (11.0 MiB/s) with 1 file(s) remaining  \r",
      "upload: PNGfiles/recording_id_13/13_val.rec to s3://nicu-data/recfiles/validation/recording_id_13/13_val.rec\n"
     ]
    }
   ],
   "source": [
    "%%bash\n",
    "#CREATE REC FILES AND SEND TO S3 STORAGE\n",
    "\n",
    "rec_ids=(2 3 4 5 6 7 8 9 10 11 12 13)\n",
    "for t in ${rec_ids[@]}\n",
    "do\n",
    "    python3 im2rec.py --list --recursive --train-ratio 0.7 \"$t\" \"PNGfiles/recording_id_$t\" #(prefix, directory)\n",
    "    mv \"$t\"_train.lst \"PNGfiles/recording_id_$t\"\n",
    "    mv \"$t\"_val.lst \"PNGfiles/recording_id_$t\"\n",
    "    python3 im2rec.py --resize 240 --quality 95 --num-thread 16 \"PNGfiles/recording_id_$t\" \"PNGfiles/recording_id_$t\" #(prefix, directory)\n",
    "    ! aws s3 cp PNGfiles/recording_id_\"$t\"/\"$t\"_train.rec s3://nicu-data/recfiles/train/recording_id_\"$t/\"\n",
    "    ! aws s3 cp PNGfiles/recording_id_\"$t\"/\"$t\"_val.rec s3://nicu-data/recfiles/validation/recording_id_\"$t/\"\n",
    "done\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:sagemaker:Couldn't call 'get_role' to get Role ARN from role name SageMakerAll to get Role path.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "This Run is for: 2\n",
      "Training job current status: InProgress\n",
      "Training job ended with status: Completed\n",
      "Training job ended with status: Completed\n",
      "image-classification-nicu-2--2019-04-30-01-03-06\n",
      "s3://nicu-data/image-classification-nicu/output/image-classification-nicu-2019-04-30-00-57-05-2/output/model.tar.gz\n",
      "arn:aws:sagemaker:us-east-1:571256666132:model/image-classification-nicu-2--2019-04-30-01-03-06\n",
      "Endpoint configuration name: image-classification-nicu-epc--2019-04-30-01-03-06\n",
      "Endpoint configuration arn:  arn:aws:sagemaker:us-east-1:571256666132:endpoint-config/image-classification-nicu-epc--2019-04-30-01-03-06\n",
      "Endpoint name: image-classification-nicu-ep--2019-04-30-01-03-07\n",
      "EndpointArn = arn:aws:sagemaker:us-east-1:571256666132:endpoint/image-classification-nicu-ep--2019-04-30-01-03-07\n",
      "EndpointStatus = Creating\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:sagemaker:Couldn't call 'get_role' to get Role ARN from role name SageMakerAll to get Role path.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Endpoint creation ended with EndpointStatus = InService\n",
      "This Run is for: 3\n",
      "Training job current status: InProgress\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:sagemaker:Couldn't call 'get_role' to get Role ARN from role name SageMakerAll to get Role path.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Endpoint creation ended with EndpointStatus = InService\n",
      "This Run is for: 11\n",
      "Training job current status: InProgress\n",
      "Training job ended with status: Completed\n",
      "Training job ended with status: Completed\n",
      "image-classification-nicu-11--2019-04-30-03-17-11\n",
      "s3://nicu-data/image-classification-nicu/output/image-classification-nicu-2019-04-30-03-11-10-11/output/model.tar.gz\n",
      "arn:aws:sagemaker:us-east-1:571256666132:model/image-classification-nicu-11--2019-04-30-03-17-11\n",
      "Endpoint configuration name: image-classification-nicu-epc--2019-04-30-03-17-11\n",
      "Endpoint configuration arn:  arn:aws:sagemaker:us-east-1:571256666132:endpoint-config/image-classification-nicu-epc--2019-04-30-03-17-11\n",
      "Endpoint name: image-classification-nicu-ep--2019-04-30-03-17-11\n",
      "EndpointArn = arn:aws:sagemaker:us-east-1:571256666132:endpoint/image-classification-nicu-ep--2019-04-30-03-17-11\n",
      "EndpointStatus = Creating\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:sagemaker:Couldn't call 'get_role' to get Role ARN from role name SageMakerAll to get Role path.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Endpoint creation ended with EndpointStatus = InService\n",
      "This Run is for: 12\n",
      "Training job current status: InProgress\n",
      "Training job ended with status: Completed\n",
      "Training job ended with status: Completed\n",
      "image-classification-nicu-12--2019-04-30-03-32-15\n",
      "s3://nicu-data/image-classification-nicu/output/image-classification-nicu-2019-04-30-03-26-14-12/output/model.tar.gz\n",
      "arn:aws:sagemaker:us-east-1:571256666132:model/image-classification-nicu-12--2019-04-30-03-32-15\n",
      "Endpoint configuration name: image-classification-nicu-epc--2019-04-30-03-32-15\n",
      "Endpoint configuration arn:  arn:aws:sagemaker:us-east-1:571256666132:endpoint-config/image-classification-nicu-epc--2019-04-30-03-32-15\n",
      "Endpoint name: image-classification-nicu-ep--2019-04-30-03-32-15\n",
      "EndpointArn = arn:aws:sagemaker:us-east-1:571256666132:endpoint/image-classification-nicu-ep--2019-04-30-03-32-15\n",
      "EndpointStatus = Creating\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:sagemaker:Couldn't call 'get_role' to get Role ARN from role name SageMakerAll to get Role path.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Endpoint creation ended with EndpointStatus = InService\n",
      "This Run is for: 13\n",
      "Training job current status: InProgress\n",
      "Training job ended with status: Completed\n",
      "Training job ended with status: Completed\n",
      "image-classification-nicu-13--2019-04-30-03-47-49\n",
      "s3://nicu-data/image-classification-nicu/output/image-classification-nicu-2019-04-30-03-41-48-13/output/model.tar.gz\n",
      "arn:aws:sagemaker:us-east-1:571256666132:model/image-classification-nicu-13--2019-04-30-03-47-49\n",
      "Endpoint configuration name: image-classification-nicu-epc--2019-04-30-03-47-49\n",
      "Endpoint configuration arn:  arn:aws:sagemaker:us-east-1:571256666132:endpoint-config/image-classification-nicu-epc--2019-04-30-03-47-49\n",
      "Endpoint name: image-classification-nicu-ep--2019-04-30-03-47-50\n",
      "EndpointArn = arn:aws:sagemaker:us-east-1:571256666132:endpoint/image-classification-nicu-ep--2019-04-30-03-47-50\n",
      "EndpointStatus = Creating\n",
      "Endpoint creation ended with EndpointStatus = InService\n",
      "CPU times: user 6.23 s, sys: 299 ms, total: 6.53 s\n",
      "Wall time: 2h 59min 16s\n"
     ]
    }
   ],
   "source": [
    "%%time\n",
    "import time\n",
    "import boto3\n",
    "import re\n",
    "import matplotlib.pyplot as plt\n",
    "import matplotlib.ticker as ticker\n",
    "import numpy as np\n",
    "from sagemaker import get_execution_role\n",
    "from time import gmtime, strftime\n",
    "\n",
    "#LOOP\n",
    "\n",
    "for baby in range(2, 14):\n",
    "    print ('This Run is for: {}'.format(baby))\n",
    "    valfile = \"/home/ec2-user/SageMaker/PNGfiles/recording_id_{}/{}_val.lst\".format(baby, baby)\n",
    "    trainfile = \"/home/ec2-user/SageMaker/PNGfiles/recording_id_{}/{}_train.lst\".format(baby, baby)\n",
    "    \n",
    "    valcount = 0\n",
    "    traincount = 0\n",
    "    \n",
    "    with open(valfile) as infp:\n",
    "        for line in infp:\n",
    "           if line.strip():\n",
    "              valcount += 1\n",
    "                \n",
    "    with open(trainfile) as infp:\n",
    "        for line in infp:\n",
    "           if line.strip():\n",
    "              traincount += 1\n",
    "\n",
    "\n",
    "    #SET-UP\n",
    "\n",
    "    role = get_execution_role()\n",
    "    s3 = boto3.client('s3')\n",
    "    bucket = 'nicu-data' # customize to your bucket\n",
    "\n",
    "    containers = {'us-west-2': '433757028032.dkr.ecr.us-west-2.amazonaws.com/image-classification:latest',\n",
    "                  'us-east-1': '811284229777.dkr.ecr.us-east-1.amazonaws.com/image-classification:latest',\n",
    "                  'us-east-2': '825641698319.dkr.ecr.us-east-2.amazonaws.com/image-classification:latest',\n",
    "                  'eu-west-1': '685385470294.dkr.ecr.eu-west-1.amazonaws.com/image-classification:latest'}\n",
    "    training_image = containers[boto3.Session().region_name]\n",
    "\n",
    "    #------------------------------------------------------------\n",
    "    #PARAMETERS\n",
    "\n",
    "    # The algorithm supports multiple network depth (number of layers). They are 18, 34, 50, 101, 152 and 200\n",
    "    # For this training, we will use 18 layers\n",
    "    num_layers = 18\n",
    "    # we need to specify the input image shape for the training data\n",
    "    image_shape = \"3,240,240\"\n",
    "    # we also need to specify the number of training samples in the training set\n",
    "    num_training_samples = valcount + traincount\n",
    "    # specify the number of output classes\n",
    "    num_classes = 4\n",
    "    # batch size for training\n",
    "    mini_batch_size =  32\n",
    "    # number of epochs\n",
    "    epochs = 10\n",
    "    # learning rate\n",
    "    learning_rate = 0.01\n",
    "\n",
    "    #------------------------------------------------------------\n",
    "    #SETTING UP THE PARAMETERS\n",
    "\n",
    "    # create unique job name \n",
    "    job_name_prefix = 'image-classification-nicu'\n",
    "    timestamp = time.strftime('-%Y-%m-%d-%H-%M-%S', time.gmtime())\n",
    "    job_name = job_name_prefix + timestamp + (\"-{}\".format(baby))\n",
    "    training_params = \\\n",
    "    {\n",
    "        # specify the training docker image\n",
    "        \"AlgorithmSpecification\": {\n",
    "            \"TrainingImage\": training_image,\n",
    "            \"TrainingInputMode\": \"File\"\n",
    "        },\n",
    "        \"RoleArn\": role,\n",
    "        \"OutputDataConfig\": {\n",
    "            \"S3OutputPath\": 's3://{}/{}/output'.format(bucket, job_name_prefix)\n",
    "        },\n",
    "        \"ResourceConfig\": {\n",
    "            \"InstanceCount\": 1,\n",
    "            \"InstanceType\": \"ml.p2.xlarge\",\n",
    "            \"VolumeSizeInGB\": 50\n",
    "        },\n",
    "        \"TrainingJobName\": job_name,\n",
    "        \"HyperParameters\": {\n",
    "            \"image_shape\": image_shape,\n",
    "            \"num_layers\": str(num_layers),\n",
    "            \"num_training_samples\": str(num_training_samples),\n",
    "            \"num_classes\": str(num_classes),\n",
    "            \"mini_batch_size\": str(mini_batch_size),\n",
    "            \"epochs\": str(epochs),\n",
    "            \"learning_rate\": str(learning_rate)\n",
    "        },\n",
    "        \"StoppingCondition\": {\n",
    "            \"MaxRuntimeInSeconds\": 360000\n",
    "        },\n",
    "    #Training data should be inside a subdirectory called \"train\"\n",
    "    #Validation data should be inside a subdirectory called \"validation\"\n",
    "    #The algorithm currently only supports fullyreplicated model (where data is copied onto each machine)\n",
    "        \"InputDataConfig\": [\n",
    "            {\n",
    "                \"ChannelName\": \"train\",\n",
    "                \"DataSource\": {\n",
    "                    \"S3DataSource\": {\n",
    "                        \"S3DataType\": \"S3Prefix\",\n",
    "                        \"S3Uri\": 's3://{}/recfiles/train/recording_id_{}'.format(bucket, baby),\n",
    "                        \"S3DataDistributionType\": \"FullyReplicated\"\n",
    "                    }\n",
    "                },\n",
    "                \"ContentType\": \"application/x-recordio\",\n",
    "                \"CompressionType\": \"None\"\n",
    "            },\n",
    "            {\n",
    "                \"ChannelName\": \"validation\",\n",
    "                \"DataSource\": {\n",
    "                    \"S3DataSource\": {\n",
    "                        \"S3DataType\": \"S3Prefix\",\n",
    "                        \"S3Uri\": 's3://{}/recfiles/validation/recording_id_{}'.format(bucket, baby),\n",
    "                        \"S3DataDistributionType\": \"FullyReplicated\"\n",
    "                    }\n",
    "                },\n",
    "                \"ContentType\": \"application/x-recordio\",\n",
    "                \"CompressionType\": \"None\"\n",
    "            }\n",
    "        ]\n",
    "    }\n",
    "\n",
    "    #------------------------------------------------------------\n",
    "    #TRAINING JOB\n",
    "\n",
    "    sagemaker = boto3.client(service_name='sagemaker')\n",
    "    sagemaker.create_training_job(**training_params)\n",
    "\n",
    "    # confirm that the training job has started\n",
    "    status = sagemaker.describe_training_job(TrainingJobName=job_name)['TrainingJobStatus']\n",
    "    print('Training job current status: {}'.format(status))\n",
    "\n",
    "    try:\n",
    "        # wait for the job to finish and report the ending status\n",
    "        sagemaker.get_waiter('training_job_completed_or_stopped').wait(TrainingJobName=job_name)\n",
    "        training_info = sagemaker.describe_training_job(TrainingJobName=job_name)\n",
    "        status = training_info['TrainingJobStatus']\n",
    "        print(\"Training job ended with status: \" + status)\n",
    "    except:\n",
    "        print('Training failed to start')\n",
    "         # if exception is raised, that means it has failed\n",
    "        message = sagemaker.describe_training_job(TrainingJobName=job_name)['FailureReason']\n",
    "        print('Training failed with the following error: {}'.format(message))\n",
    "\n",
    "    training_info = sagemaker.describe_training_job(TrainingJobName=job_name)\n",
    "    status = training_info['TrainingJobStatus']\n",
    "    print(\"Training job ended with status: \" + status)\n",
    "\n",
    "    #-----------------------------------------------------------\n",
    "    #CREATING THE MODEL\n",
    "\n",
    "    sage = boto3.Session().client(service_name='sagemaker') \n",
    "\n",
    "    model_name=\"image-classification-nicu-{}-{}\".format(baby,time.strftime('-%Y-%m-%d-%H-%M-%S', time.gmtime()))\n",
    "    print(model_name)\n",
    "    info = sage.describe_training_job(TrainingJobName=job_name)\n",
    "    model_data = info['ModelArtifacts']['S3ModelArtifacts']\n",
    "    print(model_data)\n",
    "    containers = {'us-west-2': '433757028032.dkr.ecr.us-west-2.amazonaws.com/image-classification:latest',\n",
    "                  'us-east-1': '811284229777.dkr.ecr.us-east-1.amazonaws.com/image-classification:latest',\n",
    "                  'us-east-2': '825641698319.dkr.ecr.us-east-2.amazonaws.com/image-classification:latest',\n",
    "                  'eu-west-1': '685385470294.dkr.ecr.eu-west-1.amazonaws.com/image-classification:latest'}\n",
    "    hosting_image = containers[boto3.Session().region_name]\n",
    "    primary_container = {\n",
    "        'Image': hosting_image,\n",
    "        'ModelDataUrl': model_data,\n",
    "    }\n",
    "\n",
    "    create_model_response = sage.create_model(\n",
    "        ModelName = model_name,\n",
    "        ExecutionRoleArn = role,\n",
    "        PrimaryContainer = primary_container)\n",
    "\n",
    "    print(create_model_response['ModelArn'])\n",
    "\n",
    "    #-----------------------------------------------------------\n",
    "    #ENDPOINT CONFIGURATION DETAILS\n",
    "\n",
    "    timestamp = time.strftime('-%Y-%m-%d-%H-%M-%S', time.gmtime())\n",
    "    endpoint_config_name = job_name_prefix + '-epc-' + timestamp\n",
    "    endpoint_config_response = sage.create_endpoint_config(\n",
    "        EndpointConfigName = endpoint_config_name,\n",
    "        ProductionVariants=[{\n",
    "            'InstanceType':'ml.m4.xlarge',\n",
    "            'InitialInstanceCount':1,\n",
    "            'ModelName':model_name,\n",
    "            'VariantName':'AllTraffic'}])\n",
    "\n",
    "    print('Endpoint configuration name: {}'.format(endpoint_config_name))\n",
    "    print('Endpoint configuration arn:  {}'.format(endpoint_config_response['EndpointConfigArn']))\n",
    "\n",
    "\n",
    "    #-----------------------------------------------------------\n",
    "    #CREATING THE ENDPOINT\n",
    "    timestamp = time.strftime('-%Y-%m-%d-%H-%M-%S', time.gmtime())\n",
    "    endpoint_name = job_name_prefix + '-ep-' + timestamp\n",
    "    print('Endpoint name: {}'.format(endpoint_name))\n",
    "\n",
    "    endpoint_params = {\n",
    "        'EndpointName': endpoint_name,\n",
    "        'EndpointConfigName': endpoint_config_name,\n",
    "    }\n",
    "    endpoint_response = sagemaker.create_endpoint(**endpoint_params)\n",
    "    print('EndpointArn = {}'.format(endpoint_response['EndpointArn']))\n",
    "\n",
    "    # get the status of the endpoint\n",
    "    response = sagemaker.describe_endpoint(EndpointName=endpoint_name)\n",
    "    status = response['EndpointStatus']\n",
    "    print('EndpointStatus = {}'.format(status))\n",
    "\n",
    "\n",
    "    # wait until the status has changed\n",
    "    sagemaker.get_waiter('endpoint_in_service').wait(EndpointName=endpoint_name)\n",
    "\n",
    "\n",
    "    # print the status of the endpoint\n",
    "    endpoint_response = sagemaker.describe_endpoint(EndpointName=endpoint_name)\n",
    "    status = endpoint_response['EndpointStatus']\n",
    "    print('Endpoint creation ended with EndpointStatus = {}'.format(status))\n",
    "\n",
    "    if status != 'InService':\n",
    "        raise Exception('Endpoint creation failed.')\n",
    "\n",
    "\n",
    "    runtime = boto3.Session().client(service_name='runtime.sagemaker')\n",
    "\n",
    "    \n",
    "    # CLEAN UP IN CASE OF LIMITED MODELS AND ENDPOINTS\n",
    "    #print(endpoint_name)\n",
    "    #sage.delete_endpoint(EndpointName=endpoint_name)\n",
    "    #sage.delete_endpoint_config(EndpointConfigName=endpoint_name)\n",
    "    #sage.delete_model(ModelName=endpoint_name)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "image-classification-nicu-2019-04-30-03-41-48-13\n",
      "Maximum validation accuracy: 1.000000 \n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "<Figure size 432x288 with 0 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "import boto3\n",
    "import matplotlib.pyplot as plt\n",
    "import matplotlib.ticker as ticker\n",
    "import numpy as np\n",
    "\n",
    "#BUILD CURVE\n",
    "\n",
    "client = boto3.client('logs')\n",
    "\n",
    "lgn='/aws/sagemaker/TrainingJobs'\n",
    "print(job_name)\n",
    "# Update this with the actual name in CloudWatch logs\n",
    "lsn=job_name+'/'+'algo-1-1556595898'\n",
    "\n",
    "log=client.get_log_events(logGroupName=lgn, logStreamName=lsn)\n",
    "\n",
    "trn_accs=[]\n",
    "val_accs=[]\n",
    "for e in log['events']:\n",
    "  msg=e['message']\n",
    "  if 'Validation-accuracy' in msg:\n",
    "        val = msg.split(\"=\")\n",
    "        val = val[1]\n",
    "        val_accs.append(float(val))\n",
    "  if 'Train-accuracy' in msg:\n",
    "        trn = msg.split(\"=\")\n",
    "        trn = trn[1]\n",
    "        trn_accs.append(float(trn))\n",
    "\n",
    "print(\"Maximum validation accuracy: %f \" % max(val_accs))   \n",
    "plt.clf()\n",
    "fig, ax = plt.subplots()\n",
    "plt.xlabel('Epochs')\n",
    "plt.ylabel('Accuracy')\n",
    "trn_plot, = ax.plot(range(epochs), trn_accs, label=\"Training accuracy\")\n",
    "val_plot, = ax.plot(range(epochs), val_accs, label=\"Validation accuracy\")\n",
    "plt.legend(handles=[trn_plot,val_plot])\n",
    "ax.yaxis.set_ticks(np.arange(0.4, 1.05, 0.05))\n",
    "ax.yaxis.set_major_formatter(ticker.FormatStrFormatter('%0.2f'))\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "%%time\n",
    "import time\n",
    "import boto3\n",
    "import re\n",
    "import matplotlib.pyplot as plt\n",
    "import matplotlib.ticker as ticker\n",
    "import json\n",
    "import os\n",
    "import numpy as np\n",
    "from sagemaker import get_execution_role\n",
    "from time import gmtime, strftime\n",
    "from IPython.display import Image\n",
    "\n",
    "# BUILD CONFUSION MATRIX\n",
    "\n",
    "baby = 'Kaylee'\n",
    "al = ['Arm', 'Leg']\n",
    "lr = ['Left', 'Right']\n",
    "\n",
    "A = np.zeros( (4, 4) )\n",
    "for lig in al:\n",
    "    for side in lr:\n",
    "        truth=side+lig\n",
    "        print(truth.lower())\n",
    "        if truth.lower() == 'leftarm':\n",
    "            row=0\n",
    "        elif truth.lower() == 'leftleg':\n",
    "            row=1\n",
    "        elif truth.lower() == 'rightarm':\n",
    "            row=2\n",
    "        elif truth.lower() == 'rightleg':\n",
    "            row=3\n",
    "        directory = 'cropped_1080_by_1080/{}/{}/{}/OpticalFlow'.format(baby, lig, side)\n",
    "        for filename in os.listdir(directory):\n",
    "            if filename.endswith(\".png\"):\n",
    "                testfile = directory+\"/\"+filename\n",
    "                with open(testfile, 'rb') as f:\n",
    "                    payload = f.read()\n",
    "                    payload = bytearray(payload)\n",
    "                response = boto3.Session().client(service_name='runtime.sagemaker').invoke_endpoint(EndpointName=endpoint_name, \n",
    "                                   ContentType='application/x-image', \n",
    "                                   Body=payload)\n",
    "                result = response['Body'].read()\n",
    "                # result will be in json format and convert it to ndarray\n",
    "                result = json.loads(result)\n",
    "                index = np.argmax(result)\n",
    "                \n",
    "                object_categories = ['leftarm', 'leftleg', 'rightarm', 'rightleg']\n",
    "                if object_categories[index] == 'leftarm':\n",
    "                    A[row][0] = A[row][0] + 1\n",
    "                if object_categories[index] == 'leftleg':\n",
    "                    A[row][1] = A[row][1] + 1\n",
    "                if object_categories[index] == 'rightarm':\n",
    "                    A[row][2] = A[row][2] + 1\n",
    "                if object_categories[index] == 'rightleg':\n",
    "                    A[row][3] = A[row][3] + 1\n",
    "                print(A) \n",
    "print(A) \n",
    "\n",
    "# 0 = la, 1 = ll, 2 = ra, 3 = rl\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "conda_mxnet_p36",
   "language": "python",
   "name": "conda_mxnet_p36"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
